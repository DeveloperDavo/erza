# -*- mode: Shell-script-*-
#!/usr/bin/env bash

echo '****** UPDATE ******'
cd ~

if [ ! -d erza ] ; then
    echo 'configuration is not there'
    exit 1
fi

cd erza

echo '*** Pulling latest changes from main repository ***'
git pull origin master || { echo 'ERROR: Could not pull from origin' ; exit 1; }
echo '*** Pulling latest changes from submodules ***'
git submodule update --recursive || { echo 'ERROR: Could not update submodules' ; exit 1; }

echo '*** Pulling latest images ***'
docker-compose pull || { echo 'ERROR: Could not pull images'; exit 1; }
echo '*** Building images ***'
docker-compose build || { echo 'ERROR: Could not build images'; exit 1; }
echo '*** Starting images ***'
docker-compose up -d || { echo 'ERROR: Could not start images'; exit 1; }
