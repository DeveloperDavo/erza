# -*- mode: Shell-script-*-
#!/usr/bin/env bash

echo '****** UPDATE ******'
cd ~

if [ ! -d erza ] ; then
    echo 'configuration is not there'
    exit 1
fi

cd erza

echo '*** Pulling latest changes from main repository ***'
git pull origin master || { echo 'ERROR: Could not pull from origin' ; exit 1; }
echo '*** Pulling latest changes from submodules ***'
repos=$(git submodule | awk '{ print $2 }')
for repo in $repos ; do
    echo "*** Pulling changes from ${repo} ***"
    pushd $repo
    git pull origin master || { echo "Error: Could not pull ${repo}" ; exit 1; }
    popd
done

echo '*** Pulling latest images ***'
docker-compose pull || { echo 'ERROR: Could not pull images'; exit 1; }
echo '*** Starting images ***'
docker-compose up -d --build || { echo 'ERROR: Could not start images'; exit 1; }
